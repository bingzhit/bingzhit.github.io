---
layout: post
read_time: true
show_date: true
title: SpringBoot + Langchain4j + 阿里大模型实现图片内容识别
date: 2025-07-18 12:10:23 +0800
description: C#项目AI图像识别接口
img: posts/20250718/java-ai-recognition.png
tags: [SpringBoot, Langchain4j, LLM, Java]
author: bingzhit
---

1. 新建maven工程, 添加依赖。
```xml
<dependencies>
<!--        SpringBoot依赖-->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
            <version>3.2.6</version>
        </dependency>
<!--        SpringBoot测试依赖-->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-test</artifactId>
            <version>3.2.6</version>
            <scope>test</scope>
        </dependency>
<!--        Knife4j依赖（用于测试后端接口）-->
        <dependency>
            <groupId>com.github.xiaoymin</groupId>
            <artifactId>knife4j-openapi3-jakarta-spring-boot-starter</artifactId>
            <version>4.3.0</version>
        </dependency>
<!--        Langchain4j依赖-->
        <dependency>
            <groupId>dev.langchain4j</groupId>
            <artifactId>langchain4j-spring-boot-starter</artifactId>
            <version>1.0.0-beta3</version>
        </dependency>
<!--        Langchain4j 中 qwen 模型依赖-->
        <dependency>
            <groupId>dev.langchain4j</groupId>
            <artifactId>langchain4j-community-dashscope-spring-boot-starter</artifactId>
            <version>1.0.0-beta3</version>
        </dependency>
    </dependencies>
```
2. 创建调用 qwen-vl-plus 模型识别图片内容的 assistant 类。 
```java
package cn.edu.hbu.assistant;

import dev.langchain4j.community.model.dashscope.QwenChatModel;
import dev.langchain4j.data.image.Image;
import dev.langchain4j.data.message.ImageContent;
import dev.langchain4j.data.message.TextContent;
import dev.langchain4j.data.message.UserMessage;
import dev.langchain4j.model.chat.ChatLanguageModel;
import dev.langchain4j.model.chat.response.ChatResponse;

public class RecognitionAssistant {
    public static String recognition(Image file, String prompt){
        ChatLanguageModel model = QwenChatModel.builder()
                .apiKey(System.getenv("DASH_SCOPE_API_KEY"))
                .modelName("qwen-vl-plus")
                .build();
        UserMessage userMessage = UserMessage.from(
                TextContent.from(prompt),
                ImageContent.from(file)
        );
        ChatResponse response = model.chat(userMessage);
        return response.aiMessage().text();
    }
}
```
3. 创建 controller 类, 实现识别，prompt 是提示词。
```java
package cn.edu.hbu.controller;

import cn.edu.hbu.assistant.RecognitionAssistant;
import dev.langchain4j.data.image.Image;
import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.tags.Tag;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.multipart.MultipartFile;

import java.io.IOException;
import java.util.Base64;

@RestController
@RequestMapping("/rec")
@Tag(name = "AI识别")
public class RecognitionController {


    @PostMapping("plant")
    @Operation(summary = "植物识别")
    public String plantRecognition(@RequestParam("image") MultipartFile image) throws IOException {
        String base64Data = Base64.getEncoder().encodeToString(image.getBytes());
        Image img = Image.builder().base64Data(base64Data).build();
        String prompt = """
                请识别图片中的植物，并提供以下信息：
                 1.植物名称：包括中文名和拉丁学名（如果可能）。
                 2.植物分类：属于哪一个科，属。
                 3.植物特征：描述它的叶子形状、花朵颜色、果实形态等显著特征。
                 4.生长环境：它通常生长在什么样的环境中？例如：热带、温带、湿地、沙漠等。
                 5.用途或意义：这种植物是否具有药用价值、观赏价值或其他特殊意义（如花语等）。
                 6.相似植物对比：是否存在与它外观相似的植物？如果有，请列出并指出主要区别。
                注意：如果图片清晰度不足或信息有限，请尽量给出可能性较高的推测结果，说明推测依据和给出置信度。
                """;
        return RecognitionAssistant.recognition(img, prompt);
    }

    @PostMapping("animal")
    @Operation(summary = "动物识别")
    public String animalRecognition(@RequestParam("image") MultipartFile image) throws IOException {
        String base64Data = Base64.getEncoder().encodeToString(image.getBytes());
        Image img = Image.builder().base64Data(base64Data).build();
        String prompt = """
                请识别图中的动物种类，并提供以下信息：
                1.动物的名称（学名和俗名）。
                2.动物的主要特征（如体型、颜色、斑纹等）。
                3.动物的生活习性和栖息地（如果可以推断）。
                4.如果图片中有多个动物，请分别列出它们的信息。
                注意：如果无法完全确定动物的具体种类，请提供可能的推测范围，并标注置信度（例如：可能是XX，置信度80%）。
                """;
        return RecognitionAssistant.recognition(img, prompt);
    }

    @PostMapping("carType")
    @Operation(summary = "车型识别")
    public String carTypeRecognition(@RequestParam("image") MultipartFile image) throws IOException {
        String base64Data = Base64.getEncoder().encodeToString(image.getBytes());
        Image img = Image.builder().base64Data(base64Data).build();
        String prompt = """
                请仔细分析图中车辆，并尽可能详细的识别出它的品牌、型号和年份。如果可以，请给出以下信息：
                1.车辆品牌（例如：特斯拉、奔驰等）。
                2.具体型号（例如：Model 3、X5等）。
                3.生产年份或年代范围（例如：2022款、2015-2020年间车型）。
                4.其他显著特征（例如车身颜色、特殊改装、车牌样式等）。
                如果图片中有多个车辆，请逐一列出它们的品牌和型号。同时，请注明识别的置信度。
                """;
        return RecognitionAssistant.recognition(img, prompt);
    }

    @PostMapping("carNO")
    @Operation(summary = "车牌识别")
    public String carNORecognition(@RequestParam("image") MultipartFile image) throws IOException {
        String base64Data = Base64.getEncoder().encodeToString(image.getBytes());
        Image img = Image.builder().base64Data(base64Data).build();
        String prompt = """
                请识别图片中的车牌信息，并提取出完整的车牌号码。
                如果图片中有多个车牌，请逐一列出所有车牌号码。
                如果图片中没有车牌，请返回‘未检测到车牌’。
                如果图片质量较差或车牌被遮挡，请尽可能推测可能的字符，并备注‘可能存在误差’。
                支持多语言环境下的车牌识别（如中文、英文、阿拉伯数字等）。
                """;
        return RecognitionAssistant.recognition(img, prompt);
    }

    @PostMapping("dish")
    @Operation(summary = "菜品识别")
    public String dishRecognition(@RequestParam("image") MultipartFile image) throws IOException {
        String base64Data = Base64.getEncoder().encodeToString(image.getBytes());
        Image img = Image.builder().base64Data(base64Data).build();
        String prompt = """
                请识别图片中的菜品，并提供以下信息：
                菜名：菜品的名称（包括中英文名称，如果有的话）。
                主要食材：列出菜品的主要原料和配料。
                菜系或风格：判断这道菜属于哪种菜系（如中餐、西餐、日料等）或烹饪风格（如烧烤、蒸煮、油炸等）。
                口味特点：描述菜品可能的口味（如甜、咸、酸、辣等）。
                背景信息：如果可以，请提供关于这道菜的文化背景或相关故事。
                如果图片中有多种菜品，请逐一分析并列出每道菜的信息。
                """;
        return RecognitionAssistant.recognition(img, prompt);
    }
}
```